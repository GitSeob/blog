{"ast":null,"code":"var __jsx = React.createElement;\nimport React, { useCallback, useEffect, useState } from 'react';\nimport { ConfirmPage, SubmitButtonBox } from './style';\nimport marked from 'marked';\nimport { useDispatch, useSelector } from 'react-redux';\nimport { CLOSE_CONFIRM_POST } from '@reducers/posting';\nimport { WRITE_POST_REQUEST } from '@reducers/post';\nimport SetThumbnail from '@components/write/SetThumbnail';\n\nconst ConfirmPost = ({\n  title,\n  post\n}) => {\n  const {\n    body,\n    isOpen,\n    categories,\n    isEditingId\n  } = useSelector(state => state.posting);\n  const dispatch = useDispatch();\n  const {\n    0: des,\n    1: setDes\n  } = useState(post ? post.description : '');\n  const {\n    0: isVisible,\n    1: setVisible\n  } = useState(post ? post.is_visible : true);\n  const {\n    0: thumbnails,\n    1: setThumbnails\n  } = useState((post === null || post === void 0 ? void 0 : post.thumbnail) ? [post.thumbnail] : []);\n  const {\n    0: tnIndex,\n    1: setTnIndex\n  } = useState(0);\n  const onChangeDes = useCallback(e => {\n    e.preventDefault();\n    if (e.target.value.length > 160) return;\n    setDes(e.target.value.replace('\\n', ''));\n  }, []);\n  const removeThumbnail = useCallback(() => {\n    setThumbnails(thumbnails.filter((img, i) => i !== tnIndex));\n    setTnIndex(tnIndex > 0 ? tnIndex - 1 : 0);\n  }, [tnIndex, thumbnails]);\n  const addThumbnail = useCallback(newImage => {\n    setThumbnails([newImage, ...thumbnails]);\n    setTnIndex(0);\n  }, [categories]);\n  const onSubmitPost = useCallback(() => {\n    if (!(body && title && des)) {\n      alert('description은 필수 입력 항목입니다.');\n      return;\n    }\n\n    dispatch({\n      type: WRITE_POST_REQUEST,\n      payload: {\n        isEditingId: isEditingId,\n        post: {\n          title: title,\n          description: des,\n          thumbnail: thumbnails[tnIndex],\n          is_visible: isVisible,\n          body: body\n        },\n        category: categories\n      }\n    });\n  }, [body, des, isVisible, thumbnails, tnIndex]);\n  useEffect(() => {\n    var _body$match;\n\n    if (!isOpen || !body) return;\n    const parseDesList = marked(body).match(/<\\s*p[^>]*>([^<]*)<\\s*\\/\\s*p\\s*>/g);\n    const parseDes = parseDesList === null || parseDesList === void 0 ? void 0 : parseDesList.join(' ').replace(/(<([^>]+)>)/gi, '');\n    if (parseDes) setDes(parseDes.length ? parseDes.slice(0, 160) : parseDes);\n    const thumb_imgs = (_body$match = body.match(/!\\[[^\\]]*?\\]\\([^)]+\\)/g)) === null || _body$match === void 0 ? void 0 : _body$match.map(imgString => imgString.replace(/!\\[[^\\]]*?\\]\\(/g, '').replace(')', ''));\n    setThumbnails(thumb_imgs ? [...thumbnails, ...thumb_imgs] : thumbnails);\n  }, [isOpen]);\n  return __jsx(ConfirmPage, {\n    style: {\n      left: isOpen ? 0 : '100%'\n    }\n  }, __jsx(\"div\", null, __jsx(\"h3\", null, \"\\uC378\\uB124\\uC77C \\uBBF8\\uB9AC\\uBCF4\\uAE30\"), __jsx(SetThumbnail, {\n    thumbnails: thumbnails,\n    tnIndex: tnIndex,\n    removeThumbnail: removeThumbnail,\n    setTnIndex: setTnIndex,\n    addThumbnail: addThumbnail\n  }), __jsx(\"h3\", null, \"Description \\uBBF8\\uB9AC\\uBCF4\\uAE30 \", __jsx(\"span\", null, des.length, \"/160\")), __jsx(\"textarea\", {\n    rows: 4,\n    value: des,\n    onChange: onChangeDes\n  }), __jsx(SubmitButtonBox, null, __jsx(\"div\", {\n    onClick: () => {\n      dispatch({\n        type: CLOSE_CONFIRM_POST\n      });\n    }\n  }, \"\\uCDE8\\uC18C\\uD558\\uAE30\"), __jsx(\"div\", {\n    className: isVisible ? 'selected' : '',\n    onClick: () => {\n      setVisible(!isVisible);\n    }\n  }, isVisible ? '공개' : '비공개'), __jsx(\"div\", {\n    className: \"submit\",\n    onClick: onSubmitPost\n  }, \"\\uC791\\uC131\\uD558\\uAE30\"))));\n};\n\nexport default ConfirmPost;","map":null,"metadata":{},"sourceType":"module"}